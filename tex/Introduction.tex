\chapter{はじめに}

\section{ROOTとは}
ROOT（ルート）とは、CERN（欧州原子核研究機構、セルン、サーン）によって開発されているソフトウェア・ライブラリ群の名称です\footnote{\url{https://root.cern.ch/}}\cite{Brun:1997:ROOT----An-object-oriented-data-analysis}。高エネルギー物理学のデータ処理・データ解析を主目的として、1994年からRen\'e BrunとFons Rademakersによって開発が始まりました。2021年現在、高エネルギー物理学分野での標準解析ツールとしての地位を確立しています。また近年では宇宙線や宇宙放射線（X線、ガンマ線）といった他分野でもデータ解析に使われるようになってきました。物理の観測対象によらず「イベント」の概念を持つ物理学実験においてROOTは不可欠な存在になっています。

\section{ROOTとC++}
ROOTはC++（シープラスプラス）\footnote{日本語では「シープラ」「シープラプラ」と呼ばれることが多い。}というプログラミング言語で記述されています。1980年代頃まで科学計算の主流はFORTRAN（フォートラン）でした。例えばPAW、Display 45、GEANT3といった高エネルギー物理学で使われてきたソフトウェアはFORTRANで書かれていました。1990年代に入り、より大規模で柔軟性の高いソフトウェアを構築する必要に迫られたとき、開発者が選択した言語はC++でした。C++はC言語を基にしたオブジェクト指向プログラミング（object oriented programming）が可能な言語であり、2021年現在、高エネルギー物理学業界での標準的な言語のひとつになっています。

ROOTを深く理解し正しく使用するためには、どうしてもC++を学習する必要があります。特にROOTが標準で備える機能に飽き足らず、自分で機能拡張を目指すようなユーザはC++の知識が不可欠です。

本格的なC++の解説は専門書に譲ることにして、本書でもC++の簡単な説明を第\ref{chap:C++}章でします。C++の基礎知識がある人は読み飛ばして構いませんが、C++やプログラミングの初心者には、取っ掛かりとして役立つでしょう。

\section{Python}
また近年ではC++に代わってPython（パイソン）という言語を使用する研究者も増えてきました。できるかぎり高速な処理を行いたい場合やハードウェアの制御を行う場合を除いて、CやC++よりもPythonを選択する機会が多々あります。ROOTはPythonの中からでも呼び出すことができるため、本書でもPythonの簡単な解説を第\ref{chap:Python}章で行います。

ただし、ROOTはもともとC++の枠内で使うことを想定しているため、ROOTのマニュアルやC++で書かれた例を読んでも、どのようにPythonに焼き直せば良いのか分からない場合があります。Pythonのみを学んでROOTを使うことも可能ではありますが、C++の基礎を学んでおいたほうが、よりROOTに親しめるでしょう。

研究グループや分野によってはROOTの使用を徐々にやめ、matplotlibのようなPythonの解析環境に移行しているところもあります。Pythonではオープンソース（open source）の開発コミュニティがROOTよりも活発なため、より簡単に、より様々な機能を使うことができるためです。日本ではROOTを使い続けている研究グループが多いようですが、ROOTが解析手段の絶対的存在ではないということを知っておきましょう。

\section{高エネルギー宇宙物理学でのROOTの利用例}
To be written\ldots
%高エネルギー宇宙物理学\footnote{X線から最高エネルギー宇宙線までの範囲を、このように総称することにする。}でROOTを利用する場面は多岐にわたる。例えば放射線同位体のスペクトルをシンチレータと光電子増倍管で測定する場合、光電子増倍管の出力値をヒストグラムに詰め、ピーク形状をガウシアンでフィッティングする作業が考えられる。我々が研究に使える時間は限られており、ヒストグラムやフィッティングの計算を自前で用意するのは現実的に不可能であり、また間違いを犯す可能性が高い。このような場合、ROOTのような既存のソフトウェアを使うことによって、必要な作業を最小限の時間で行うことができる。

%1980年代までは、科学計算の主役言語はFORTRANであった。例えば、PAWやDisplay 45という古い解析ソフトウェアはFORTRANで記述されている。しかしC言語の浸透やオブジェクト指向言語の広まりとともに、高エネルギー物理学の分野でC++が採用されるようになった。ROOTはC++によって書かれており、CLHEPやGeant4のようなライブラリもC++で作成されている。そのため、ROOTを十分に使いこなし、また関連するソフトウェアを利用するためには、C++の理解が必須である。さらに、近年ではスクリプト言語であるPythonが好んで使われている。

\section{本書の目的}

本書の第一の目的は、ROOTを使ったデータ解析を行えるようになることです。ROOTの機能を全て網羅することはできませんので、説明できるのは基本的かつ必須な機能に絞られてしまいます。しかし、ひとたびROOTの基本さえ理解すれば、発展的な内容は自分で学習を進めることが可能なはずです。

第二の目的は、ROOTの学習を足がかりにしてC++やPythonといったプログラミング言語に慣れ親しむことです。自分でプログラミングができるようになれば、より複雑なデータ解析や、ソフトウェアの構築を自ら行えるようになるでしょう。

これらの目的に合致した適切な文書は、ROOTの公式マニュアル以外にはあまり見当たりません。しかし初心者にとって、ROOTのマニュアルを最初の入門書として読み進めることが適切だとは言えません。インターネット上にもROOTに関する情報は多く存在しますが、断片的な情報が多く、体系的にまとめられたものはやはり無いようです。研究室にROOTの熟練者がいれば、後輩達に指導を行うこともできるでしょうが、同じ説明を毎年全国各地で繰り返すのも時間の無駄です。本書では、共通に使用できるROOTの入門書として使われることを目指しています。

筆者はROOTやC++の多くを独学で勉強しました。当時の自分を振り返り、「こんな入門書があれば分かりやすかったのに」という思いをもとに本書を執筆しました。筆者の独学による狭い視点のため、本書の説明が我流であったり間違っていたりする可能性が多々あります。もしお気づきの点がありましたら、ぜひご指摘いただければ幸いです。また追加してほしい話題や説明がありましたら、ご要望を頂ければ出来る限り対応します。

また本書を作成する際の{\LaTeX}ファイルや例題として登場するC++のコードなどは、全て\url{https://github.com/akira-okumura/RHEA/tree/master/src}から入手可能です。もし必要であれば参照して下さい。また本書の最新版は\url{https://github.com/akira-okumura/RHEA/releases}からPDFで入手可能です。

\section{ROOTの学習方法}
物理の勉強方法は個々人で様々なように、ROOTの学習方法にも決まったやり方は存在しません。しかし、初心者の場合にはある程度の指針があったほうが学習しやすいでしょう。以下に、いくつかの学習方法を紹介します。
\subsection{マニュアル・入門書を読む}
ROOTの最も体系的に書かれた教科書は、公式のマニュアル『ROOT User's Guide』です。\url{http://root.cern.ch/drupal/content/users-guide}からPDFが入手可能です。600ページ超ある長いものであり説明も多岐にわたるため、「どこからROOTを始めたらいいのだろう」という初心者に読みこなすのは大変です。しかし、世の中に存在するROOTの説明書で最も詳しいものですので、英語の勉強がてら読み進めると良いでしょう。

もっと簡単なものが欲しいという向きには、日本語の以下のものが有名ですが、どちらともかなり古いです。
\begin{itemize}
  \item 『ROOT Which Even Monkey Can Use』Shirasaki and Tajima
  \item 『Dis45 ユーザーのための ROOT 入門 --猿にも使える ROOT：番外編--』藤井恵介
\end{itemize}
両者ともインターネット上で検索すればPDFやPSファイルが見つかるはずですので、必要があれば検索して下さい。もちろん、本書はこれらの入門書を越えることを目指して執筆されています。

\subsection{実際に書いてみる}

マニュアルや入門書を片手に、実際に自分で例題や解析プログラムを書いて実行しましょう。最初は人の真似をしながら、そして、自分の解析目的に応じて、より複雑なプログラムを書いてみましょう。最初は沢山のエラーや予期しない動作に悩まされるはずです。しかし、そのような苦労をして、最終的にROOTやC++を習得するしかありません。失敗は成功への第一歩です。沢山間違えましょう。

\subsection{ソースコードを読む}

マニュアルや入門書に書かれていない機能を使いこなすのは、なかなか難しいものです。自分の作成したヒストグラムを使って複雑な処理をしたい場合、実はその機能は既にROOTが持っている機能かもしれません。そのような場合は、ROOTのソースコードを読んでみましょう。既に実装された機能が見つかるかもしれません。

ROOTが内部で実際にどのような処理をしているかを知りたい場合も、ソースコードを絶対に読まなくてはいけません。例えば、1次元ヒストグラムの平均値をROOTから取り出したとします。このとき、平均値をROOTはどのように計算しているのでしょうか。平均値はビン幅に影響されるのでしょうか、されないのでしょうか。データ解析をするということは、ROOTをブラックボックスとして使用するのではなく、このような内部の処理をユーザの責任で理解していなくてはいけません。

ソースコードを読むには、ROOTのレファレンスガイドを\url{https://root.cern.ch/doc/master/annotated.html}から参照するとよいでしょう。先ほどの平均値の問いに答えるためには、\url{http://root.cern.ch/root/html/TH1.html}から1次元ヒストグラムのクラスであるTH1の説明に行きましょう。そこからどんどんリンクを辿って行けば、答えが見つかるはずです。

\subsection{インターネットを利用する}
インターネットが発達し、欲しい情報は簡単に手に入るようになりました。特にコンピュータやプログラミングに関する知識は、書籍の情報量を圧倒します。その分、情報が断片的であったり、情報の質がバラバラだったりします。初心者の悩みを解決する情報は、大抵インターネット上に転がっています。エラーが出た場合にはそのエラーメッセージで検索しましょう。また、単純に「ROOT」と検索すると、管理者ユーザの意味での「root」が大量にヒットしてしまいます。「CERN」という単語を混ぜる等して工夫して下さい。

また、「〜〜するには、どのようにしたらよいか」のような疑問は、「how to」のような語をつけて検索するとよいでしょう。例えばヒストグラム同士の割り算の仕方を調べたければ、「how to divide histogram root cern」などと検索すれば答えが見つかるはずです。

調べても分からないこと、マニュアルやソースコードの説明が不十分な場合には、ROOTの公式フォーラム（\url{https://root-forum.cern.ch}）を利用することもできます。かつてはメーリングリスト（\url{https://groups.cern.ch/group/roottalk/default.aspx}）も使用されていましたが、今は公式フォーラムの利用が推奨されています。これらに自ら投稿しなくても、眺めたり検索するだけで有用な情報を得ることができるはずですので、是非活用して下さい。質問する場合は、\url{https://root.cern.ch/guidelines-submitting-bug}を熟読しましょう。

\subsection{C++の勉強をする}
既に書きましたが、ROOTとC++は切り離せない関係にあります。ROOTを深く学ぶためには、C++を知らなくてはいけません。あなたが疑問に思った点は、実はROOTに関することではなくC++自体かもしれません。研究室や図書館にあるもので構いませんので、適宜C++の本を参照するようにしましょう。C++を理解できれば、ROOTを学ぶ速度は劇的に改善するはずです。
